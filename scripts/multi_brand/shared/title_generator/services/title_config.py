"""
标题生成系统 - 配置文件
版本：v6.0 - 方案C混合模式

本模块整合标题生成相关的配置常量，复用现有配置模块。
"""

import re
from typing import Dict, List

# 导入已有的品牌配置
from ..config.brands import (
    BRAND_KEYWORDS, BRAND_MAP, BRAND_SHORT_NAME
)

# ============================================================================
# 一、大分类（简化版）
# ============================================================================

# 大分类枚举
CATEGORY_OUTERWEAR = '外套'
CATEGORY_TOP = '上衣'
CATEGORY_BOTTOM = '下装'
CATEGORY_SHOES = '鞋类'
CATEGORY_ACCESSORY = '配件'
CATEGORY_RAINWEAR = '雨具'

# 小配件类型（需要特殊处理）
SMALL_ACCESSORIES = {
    '袜子', '帽子', '鸭舌帽', '遮阳帽', '球帽',
    '腰带', '皮带', '手套', '护腕', '腕带', 
    '头带', '发带', '围脖', '脖套'
}

# ============================================================================
# 二、允许的结尾词（完整列表）
# ============================================================================

ALLOWED_ENDINGS_APPAREL = [
    # 外套类
    '外套', '夹克', '马甲', '背心', '棉服', '羽绒服', '抓绒衫',
    # 上衣类
    'POLO衫', '针织衫', '卫衣', '上衣', '半袖', 'T恤',
    # 下装类
    '长裤', '短裤', '裙子',
    # 鞋类
    '球鞋', '运动鞋',
    # 配件
    '球帽', '手套',
    # 雨具
    '雨衣', '雨裤'
]

ALLOWED_ENDINGS_ACCESSORIES = [
    # 袜子类
    '袜子', '中筒袜', '短袜', '长筒袜', '运动袜', '高筒袜',
    # 帽子类
    '帽子', '鸭舌帽', '遮阳帽', '球帽', '毛线帽', '针织帽',
    # 腰带
    '腰带', '皮带',
    # 手套
    '手套', '半指手套', '全指手套',
    # 护具
    '护腕', '腕带', '头带', '发带',
    # 围脖
    '围脖', '脖套'
]

# ============================================================================
# 三、禁止词（完整列表）
# ============================================================================

FORBIDDEN_WORDS = [
    '服饰', '精品', '再入荷', '限定', '定番',
    '配色切替', '裏地付', '踵', '調',
    '球场', '训练', '球局', '练习',
    '在线', 'オンライン', 'online'
]

# ============================================================================
# 四、文本清理规则
# ============================================================================

# 日文字符正则（从 clothing.py 导入）
# JAPANESE_CHAR_PATTERN 已从 feishu_update.config.clothing 导入

# 全角数字转半角（从 clothing.py 导入）
# FULLWIDTH_TO_HALFWIDTH 已从 feishu_update.config.clothing 导入

# 繁体转简体映射（从 clothing.py 导入）
# TRADITIONAL_TO_SIMPLIFIED 已从 feishu_update.config.clothing 导入

# 重复模式检测（连续重复2字以上片段）
REPEAT_PATTERN = re.compile(r'(.{2,})\1+')

# ============================================================================
# 五、长度限制
# ============================================================================

# 标准服装
APPAREL_MIN_LEN = 26
APPAREL_MAX_LEN = 30

# 小配件
ACCESSORY_MIN_LEN = 25
ACCESSORY_MAX_LEN = 30

# ============================================================================
# 六、GLM配置
# ============================================================================

TITLE_MODEL = 'glm-4.5-air'
GLM_MIN_INTERVAL = 0.4
GLM_MAX_RETRIES = 3
GLM_BACKOFF_FACTOR = 1.8

# ============================================================================
# 七、错误标题特征（用于检测）
# ============================================================================

# 错误标题的特征词（如果包含这些，说明GLM没有直接输出标题）
ERROR_INDICATORS = [
    '要求', '必须', '禁止', '示例', '格式', '结构',
    '字符', '长度', '出现一次', '不能', '应该',
    '建议', '注意', '说明', '表格', '列表',
    '如下', '以下', '参考', '正确', '错误',
    # 表格/列表标记
    '-', '*', '|', '•', '·', '□', '■',
    '步骤', '第一', '第二', '首先', '其次',
]

# 截断字符（不完整的结尾）
TRUNCATION_CHARS = ['精', '保', '定', '再', '限', '配', '調', '踵', '场', '练', '局', '运', '防', '透']