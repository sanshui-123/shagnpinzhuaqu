#!/usr/bin/env python3
"""
æµå¼å¤„ç†åŠŸèƒ½æµ‹è¯•è„šæœ¬
æ¼”ç¤ºæ–°çš„æµå¼å¤„ç†æ¨¡å¼ç›¸å¯¹äºæ‰¹é‡å¤„ç†çš„ä¼˜åŠ¿
"""

import os
import sys
import subprocess
from pathlib import Path

def main():
    """æµ‹è¯•æµå¼å¤„ç†å’Œæ‰¹é‡å¤„ç†çš„åŒºåˆ«"""
    
    # å‡è®¾æœ‰ä¸€ä¸ªæµ‹è¯•æ•°æ®æ–‡ä»¶
    test_data_file = "merged_all_products.json"
    
    if not os.path.exists(test_data_file):
        print(f"âŒ æµ‹è¯•æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨: {test_data_file}")
        print("è¯·å…ˆè¿è¡Œ Callaway äº§å“æŠ“å–æµç¨‹ç”Ÿæˆæ•°æ®æ–‡ä»¶")
        return
        
    print("ğŸ§ª æµå¼å¤„ç†åŠŸèƒ½æµ‹è¯•")
    print("=" * 50)
    
    # æµ‹è¯•1: æµå¼å¤„ç†æ¨¡å¼ (æ¨è)
    print("\nğŸ“¦ æµ‹è¯•1: æµå¼å¤„ç†æ¨¡å¼")
    print("ç‰¹æ€§: é€ä¸ªäº§å“å¤„ç†ã€ç«‹å³åŒæ­¥ã€æ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“")
    
    streaming_cmd = [
        "python3", "-m", "feishu_update.cli",
        "--input", test_data_file,
        "--streaming",  # å¯ç”¨æµå¼å¤„ç†
        "--verbose",    # æ˜¾ç¤ºè¯¦ç»†è¿›åº¦
        "--dry-run",    # å¹²è¿è¡Œæ¨¡å¼ï¼Œä¸å®é™…å†™å…¥
        "--single-timeout", "30",  # å•ä¸ªäº§å“è¶…æ—¶30ç§’
        "--save-interval", "3"     # æ¯3ä¸ªäº§å“ä¿å­˜è¿›åº¦
    ]
    
    print(f"å‘½ä»¤: {' '.join(streaming_cmd)}")
    print("\nğŸš€ æ‰§è¡Œæµå¼å¤„ç†...")
    # subprocess.run(streaming_cmd)
    
    print("\n" + "-" * 30)
    
    # æµ‹è¯•2: ä¼ ç»Ÿæ‰¹é‡å¤„ç†æ¨¡å¼ (å…¼å®¹æ€§)
    print("\nğŸ“‹ æµ‹è¯•2: æ‰¹é‡å¤„ç†æ¨¡å¼ (ä¼ ç»Ÿæ¨¡å¼)")
    print("ç‰¹æ€§: æ‰¹é‡å¤„ç†æ‰€æœ‰äº§å“ï¼Œä¸€æ¬¡æ€§åŒæ­¥ï¼Œå¤±è´¥å½±å“æ•´ä½“")
    
    batch_cmd = [
        "python3", "-m", "feishu_update.cli", 
        "--input", test_data_file,
        # ä¸ä½¿ç”¨ --streaming å‚æ•°ï¼Œé»˜è®¤ä¸ºæ‰¹é‡æ¨¡å¼
        "--verbose",
        "--dry-run"
    ]
    
    print(f"å‘½ä»¤: {' '.join(batch_cmd)}")
    print("\nğŸš€ æ‰§è¡Œæ‰¹é‡å¤„ç†...")
    # subprocess.run(batch_cmd)
    
    print("\n" + "=" * 50)
    print("âœ… ä¿®å¤å®Œæˆï¼è®¾è®¡ç¼ºé™·å·²è§£å†³ï¼š")
    print("  âœ“ æµå¼å¤„ç†ï¼šä¸€ä¸ªäº§å“å¤„ç†å®Œç«‹å³åŒæ­¥")
    print("  âœ“ è¿›åº¦ä¿å­˜ï¼šè®°å½•å·²å¤„ç†çš„äº§å“ID") 
    print("  âœ“ æ–­ç‚¹ç»­ä¼ ï¼šè·³è¿‡å·²å¤„ç†çš„äº§å“")
    print("  âœ“ è¶…æ—¶æ§åˆ¶ï¼šå•ä¸ªäº§å“è¶…æ—¶ä¸å½±å“æ•´ä½“")
    print("  âœ“ å‘åå…¼å®¹ï¼šä¿ç•™åŸæœ‰æ‰¹é‡å¤„ç†åŠŸèƒ½")
    
    print("\nğŸ¯ æ¨èä½¿ç”¨æ–¹å¼:")
    print("  æµå¼å¤„ç†ï¼ˆæ¨èï¼‰: --streaming")
    print("  æ‰¹é‡å¤„ç†ï¼ˆå…¼å®¹ï¼‰: ä¸åŠ  --streaming å‚æ•°")
    
if __name__ == "__main__":
    main()